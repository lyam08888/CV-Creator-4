<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug CV Creator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .info { color: blue; }
        button { padding: 10px; margin: 5px; background: #3B82F6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üîç Debug CV Creator</h1>
    
    <div class="section">
        <h2>üöÄ Actions Rapides</h2>
        <button onclick="window.open('http://localhost:8000', '_blank')">Ouvrir l'Application</button>
        <button onclick="testApp()">Tester l'Application</button>
        <button onclick="checkConsole()">V√©rifier Console</button>
    </div>
    
    <div class="section">
        <h2>üìä R√©sultats des Tests</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="section">
        <h2>üêõ Erreurs D√©tect√©es</h2>
        <div id="error-log"></div>
    </div>

    <script>
        const testResults = document.getElementById('test-results');
        const errorLog = document.getElementById('error-log');
        
        // Capturer les erreurs
        window.addEventListener('error', function(e) {
            errorLog.innerHTML += `<div class="error">‚ùå ${e.message} (${e.filename}:${e.lineno})</div>`;
        });
        
        function testApp() {
            testResults.innerHTML = '<h3>üß™ Test en cours...</h3>';
            
            // Cr√©er un iframe pour tester l'app
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = '1px solid #ccc';
            iframe.style.marginTop = '10px';
            
            iframe.onload = function() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    const iframeDoc = iframe.contentDocument;
                    
                    // Tester les √©l√©ments essentiels
                    const tests = [
                        { name: 'Formulaire CV', test: () => iframeDoc.getElementById('cv-form') !== null },
                        { name: 'Aper√ßu CV', test: () => iframeDoc.getElementById('cv-preview') !== null },
                        { name: 'Boutons Navigation', test: () => iframeDoc.querySelectorAll('.nav-btn').length > 0 },
                        { name: 'Bouton Nouveau CV', test: () => iframeDoc.getElementById('btnNewCV') !== null },
                        { name: 'Bouton Charger D√©mo', test: () => iframeDoc.getElementById('btnResetToDemo') !== null },
                        { name: 'Bouton Export PDF', test: () => iframeDoc.getElementById('btnExport') !== null }
                    ];
                    
                    let results = '<h3>‚úÖ R√©sultats des Tests</h3>';
                    let passedTests = 0;
                    
                    tests.forEach(test => {
                        try {
                            const passed = test.test();
                            if (passed) {
                                results += `<div class="success">‚úÖ ${test.name}: OK</div>`;
                                passedTests++;
                            } else {
                                results += `<div class="error">‚ùå ${test.name}: √âCHEC</div>`;
                            }
                        } catch (e) {
                            results += `<div class="error">‚ùå ${test.name}: ERREUR - ${e.message}</div>`;
                        }
                    });
                    
                    results += `<div class="info"><strong>Score: ${passedTests}/${tests.length} tests r√©ussis</strong></div>`;
                    
                    // Tester les √©v√©nements
                    results += '<h4>üéØ Test des √âv√©nements</h4>';
                    
                    // Test clic navigation
                    const navBtn = iframeDoc.querySelector('.nav-btn');
                    if (navBtn) {
                        try {
                            navBtn.click();
                            results += '<div class="success">‚úÖ Navigation: Clic fonctionne</div>';
                        } catch (e) {
                            results += `<div class="error">‚ùå Navigation: Erreur - ${e.message}</div>`;
                        }
                    }
                    
                    testResults.innerHTML = results;
                    
                    // √âcouter les erreurs de l'iframe
                    iframeWindow.addEventListener('error', function(e) {
                        errorLog.innerHTML += `<div class="error">üî¥ Erreur App: ${e.message}</div>`;
                    });
                    
                } catch (e) {
                    testResults.innerHTML = `<div class="error">‚ùå Impossible de tester l'iframe: ${e.message}</div>`;
                }
                
                document.body.appendChild(iframe);
            };
            
            iframe.onerror = function() {
                testResults.innerHTML = '<div class="error">‚ùå Erreur de chargement de l\'application</div>';
            };
        }
        
        function checkConsole() {
            errorLog.innerHTML = '<h3>üîç V√©rification Console</h3>';
            
            // V√©rifier si le serveur r√©pond
            fetch('http://localhost:8000')
                .then(response => {
                    if (response.ok) {
                        errorLog.innerHTML += '<div class="success">‚úÖ Serveur accessible</div>';
                        
                        // V√©rifier les fichiers essentiels
                        const files = [
                            'js/app.js',
                            'js/customization.js', 
                            'js/preview.js',
                            'css/app.css'
                        ];
                        
                        files.forEach(file => {
                            fetch(`http://localhost:8000/${file}`)
                                .then(r => {
                                    if (r.ok) {
                                        errorLog.innerHTML += `<div class="success">‚úÖ ${file} accessible</div>`;
                                    } else {
                                        errorLog.innerHTML += `<div class="error">‚ùå ${file} non accessible (${r.status})</div>`;
                                    }
                                })
                                .catch(e => {
                                    errorLog.innerHTML += `<div class="error">‚ùå ${file} erreur: ${e.message}</div>`;
                                });
                        });
                        
                    } else {
                        errorLog.innerHTML += `<div class="error">‚ùå Serveur erreur: ${response.status}</div>`;
                    }
                })
                .catch(error => {
                    errorLog.innerHTML += `<div class="error">‚ùå Serveur inaccessible: ${error.message}</div>`;
                });
        }
        
        // Auto-test au chargement
        document.addEventListener('DOMContentLoaded', function() {
            checkConsole();
            setTimeout(testApp, 1000);
        });
    </script>
</body>
</html>