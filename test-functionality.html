<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de FonctionnalitÃ© - CV Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #7C3AED;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Test de FonctionnalitÃ© - CV Creator</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ RÃ©sumÃ© des Tests</h2>
        <div id="summary" class="info">
            <p>Cliquez sur "Lancer tous les tests" pour vÃ©rifier le bon fonctionnement de l'application.</p>
        </div>
        <button class="test-button" onclick="runAllTests()">ğŸš€ Lancer tous les tests</button>
        <button class="test-button" onclick="openMainApp()">ğŸ“± Ouvrir l'application principale</button>
    </div>

    <div class="test-section">
        <h2>ğŸ” Tests Individuels</h2>
        <button class="test-button" onclick="testJavaScriptFiles()">ğŸ“„ VÃ©rifier les fichiers JS</button>
        <button class="test-button" onclick="testDragAndDrop()">ğŸ–±ï¸ Tester Drag & Drop</button>
        <button class="test-button" onclick="testNavigation()">ğŸ§­ Tester Navigation</button>
        <button class="test-button" onclick="testFormHandlers()">ğŸ“ Tester Formulaires</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š RÃ©sultats des Tests</h2>
        <div id="test-results"></div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        async function testJavaScriptFiles() {
            addResult('ğŸ” VÃ©rification des fichiers JavaScript...', 'info');
            
            const files = [
                './js/app.js',
                './js/drag.js',
                './js/preview.js',
                './js/ai.js',
                './js/customization.js'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const content = await response.text();
                        if (content.includes('<<<<<<< HEAD') || content.includes('=======') || content.includes('>>>>>>> ')) {
                            addResult(`âŒ ${file} contient encore des conflits Git`, 'error');
                        } else {
                            addResult(`âœ… ${file} - OK`, 'success');
                        }
                    } else {
                        addResult(`âŒ ${file} - Fichier non trouvÃ©`, 'error');
                    }
                } catch (error) {
                    addResult(`âŒ ${file} - Erreur: ${error.message}`, 'error');
                }
            }
        }

        function testDragAndDrop() {
            addResult('ğŸ–±ï¸ Test du systÃ¨me Drag & Drop...', 'info');
            
            if (typeof window.Sortable !== 'undefined') {
                addResult('âœ… Sortable.js est chargÃ©', 'success');
            } else {
                addResult('âŒ Sortable.js n\'est pas chargÃ©', 'error');
            }

            // Test de l'existence des fonctions de drag & drop
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    if (iframeWindow.initDragAndDrop) {
                        addResult('âœ… Fonction initDragAndDrop disponible', 'success');
                    } else {
                        addResult('âŒ Fonction initDragAndDrop non disponible', 'error');
                    }
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`âŒ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        function testNavigation() {
            addResult('ğŸ§­ Test de la navigation...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument;
                    const navButtons = iframeDoc.querySelectorAll('.nav-btn');
                    const formSections = iframeDoc.querySelectorAll('.form-section');
                    
                    if (navButtons.length > 0) {
                        addResult(`âœ… ${navButtons.length} boutons de navigation trouvÃ©s`, 'success');
                    } else {
                        addResult('âŒ Aucun bouton de navigation trouvÃ©', 'error');
                    }
                    
                    if (formSections.length > 0) {
                        addResult(`âœ… ${formSections.length} sections de formulaire trouvÃ©es`, 'success');
                    } else {
                        addResult('âŒ Aucune section de formulaire trouvÃ©e', 'error');
                    }
                    
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`âŒ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        function testFormHandlers() {
            addResult('ğŸ“ Test des gestionnaires de formulaire...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument;
                    const buttons = [
                        'btnAddExperience',
                        'btnAddEducation',
                        'btnGenerateIA',
                        'btnExport'
                    ];
                    
                    let foundButtons = 0;
                    buttons.forEach(buttonId => {
                        const button = iframeDoc.getElementById(buttonId);
                        if (button) {
                            foundButtons++;
                            addResult(`âœ… Bouton ${buttonId} trouvÃ©`, 'success');
                        } else {
                            addResult(`âŒ Bouton ${buttonId} non trouvÃ©`, 'error');
                        }
                    });
                    
                    addResult(`ğŸ“Š ${foundButtons}/${buttons.length} boutons trouvÃ©s`, 'info');
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`âŒ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        async function runAllTests() {
            clearResults();
            addResult('ğŸš€ Lancement de tous les tests...', 'info');
            
            await testJavaScriptFiles();
            testDragAndDrop();
            testNavigation();
            testFormHandlers();
            
            setTimeout(() => {
                addResult('âœ… Tous les tests terminÃ©s !', 'success');
                updateSummary();
            }, 2000);
        }

        function updateSummary() {
            const results = document.querySelectorAll('#test-results .status');
            const successCount = document.querySelectorAll('#test-results .success').length;
            const errorCount = document.querySelectorAll('#test-results .error').length;
            
            const summary = document.getElementById('summary');
            if (errorCount === 0) {
                summary.className = 'status success';
                summary.innerHTML = `ğŸ‰ Tous les tests sont passÃ©s avec succÃ¨s ! (${successCount} rÃ©ussites)`;
            } else {
                summary.className = 'status error';
                summary.innerHTML = `âš ï¸ ${errorCount} erreur(s) dÃ©tectÃ©e(s) sur ${results.length} tests. ${successCount} rÃ©ussites.`;
            }
        }

        function openMainApp() {
            window.open('./index.html', '_blank');
        }
    </script>
</body>
</html>