<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Fonctionnalité - CV Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #7C3AED;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>🔧 Test de Fonctionnalité - CV Creator</h1>
    
    <div class="test-section">
        <h2>📋 Résumé des Tests</h2>
        <div id="summary" class="info">
            <p>Cliquez sur "Lancer tous les tests" pour vérifier le bon fonctionnement de l'application.</p>
        </div>
        <button class="test-button" onclick="runAllTests()">🚀 Lancer tous les tests</button>
        <button class="test-button" onclick="openMainApp()">📱 Ouvrir l'application principale</button>
    </div>

    <div class="test-section">
        <h2>🔍 Tests Individuels</h2>
        <button class="test-button" onclick="testJavaScriptFiles()">📄 Vérifier les fichiers JS</button>
        <button class="test-button" onclick="testDragAndDrop()">🖱️ Tester Drag & Drop</button>
        <button class="test-button" onclick="testNavigation()">🧭 Tester Navigation</button>
        <button class="test-button" onclick="testFormHandlers()">📝 Tester Formulaires</button>
    </div>

    <div class="test-section">
        <h2>📊 Résultats des Tests</h2>
        <div id="test-results"></div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        async function testJavaScriptFiles() {
            addResult('🔍 Vérification des fichiers JavaScript...', 'info');
            
            const files = [
                './js/app.js',
                './js/drag.js',
                './js/preview.js',
                './js/ai.js',
                './js/customization.js'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const content = await response.text();
                        if (content.includes('<<<<<<< HEAD') || content.includes('=======') || content.includes('>>>>>>> ')) {
                            addResult(`❌ ${file} contient encore des conflits Git`, 'error');
                        } else {
                            addResult(`✅ ${file} - OK`, 'success');
                        }
                    } else {
                        addResult(`❌ ${file} - Fichier non trouvé`, 'error');
                    }
                } catch (error) {
                    addResult(`❌ ${file} - Erreur: ${error.message}`, 'error');
                }
            }
        }

        function testDragAndDrop() {
            addResult('🖱️ Test du système Drag & Drop...', 'info');
            
            if (typeof window.Sortable !== 'undefined') {
                addResult('✅ Sortable.js est chargé', 'success');
            } else {
                addResult('❌ Sortable.js n\'est pas chargé', 'error');
            }

            // Test de l'existence des fonctions de drag & drop
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    if (iframeWindow.initDragAndDrop) {
                        addResult('✅ Fonction initDragAndDrop disponible', 'success');
                    } else {
                        addResult('❌ Fonction initDragAndDrop non disponible', 'error');
                    }
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`❌ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        function testNavigation() {
            addResult('🧭 Test de la navigation...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument;
                    const navButtons = iframeDoc.querySelectorAll('.nav-btn');
                    const formSections = iframeDoc.querySelectorAll('.form-section');
                    
                    if (navButtons.length > 0) {
                        addResult(`✅ ${navButtons.length} boutons de navigation trouvés`, 'success');
                    } else {
                        addResult('❌ Aucun bouton de navigation trouvé', 'error');
                    }
                    
                    if (formSections.length > 0) {
                        addResult(`✅ ${formSections.length} sections de formulaire trouvées`, 'success');
                    } else {
                        addResult('❌ Aucune section de formulaire trouvée', 'error');
                    }
                    
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`❌ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        function testFormHandlers() {
            addResult('📝 Test des gestionnaires de formulaire...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = './index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument;
                    const buttons = [
                        'btnAddExperience',
                        'btnAddEducation',
                        'btnGenerateIA',
                        'btnExport'
                    ];
                    
                    let foundButtons = 0;
                    buttons.forEach(buttonId => {
                        const button = iframeDoc.getElementById(buttonId);
                        if (button) {
                            foundButtons++;
                            addResult(`✅ Bouton ${buttonId} trouvé`, 'success');
                        } else {
                            addResult(`❌ Bouton ${buttonId} non trouvé`, 'error');
                        }
                    });
                    
                    addResult(`📊 ${foundButtons}/${buttons.length} boutons trouvés`, 'info');
                    document.body.removeChild(iframe);
                } catch (error) {
                    addResult(`❌ Erreur lors du test: ${error.message}`, 'error');
                    document.body.removeChild(iframe);
                }
            };
        }

        async function runAllTests() {
            clearResults();
            addResult('🚀 Lancement de tous les tests...', 'info');
            
            await testJavaScriptFiles();
            testDragAndDrop();
            testNavigation();
            testFormHandlers();
            
            setTimeout(() => {
                addResult('✅ Tous les tests terminés !', 'success');
                updateSummary();
            }, 2000);
        }

        function updateSummary() {
            const results = document.querySelectorAll('#test-results .status');
            const successCount = document.querySelectorAll('#test-results .success').length;
            const errorCount = document.querySelectorAll('#test-results .error').length;
            
            const summary = document.getElementById('summary');
            if (errorCount === 0) {
                summary.className = 'status success';
                summary.innerHTML = `🎉 Tous les tests sont passés avec succès ! (${successCount} réussites)`;
            } else {
                summary.className = 'status error';
                summary.innerHTML = `⚠️ ${errorCount} erreur(s) détectée(s) sur ${results.length} tests. ${successCount} réussites.`;
            }
        }

        function openMainApp() {
            window.open('./index.html', '_blank');
        }
    </script>
</body>
</html>